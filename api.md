# Документация по использованию API

Общий вид ответа сервера в случае успешного запроса:

```json
{
  "response": /* ответ может представлять любой тип данных */
}
```

Общий вид ответа сервера в случае ошибочного запроса:

```json
{
  "error": {
    "error_code": /* общий код ошибки */,
    "details": /* детали ошибки, могут быть представлены любым типом данных */
  }
}
```

См. [Общие коды ошибок](https://github.com/shuryak/StupidSocialNetwork/blob/master/api.md#общие-коды-ошибок "Общие коды ошибок").

## Неймспейсы API

### `Users`

Неймспейс `Users` предоставляет доступ к основной информации о пользователях. 

Доступные методы:

- `users.register` – метод для регистрации пользователя:

  Параметры:

  - `email` – *строка в формате Email-адреса*, например, `"mail@shuryak.com"`;
  - `firstname` – *строка*, например, `"Alexander"`. От 1 до 32 символов;
  - `lastname` – *строка*, например, `"Konovalov"`. От 1 до 32 символов;
  - `password` – *строка*, содержащая пароль из любых символов. Не короче 
  6-и символов.

  В случае успешного выполнения, в `response` вернётся `true`.

- `users.login` – метод для входа в аккаунт пользователя (получения пары 
  токенов `access_token` / `refresh_token`):

  Параметры:

  - `email` – *строка в формате Email-адреса*, например, `"mail@shuryak.com"`;
  - `password` – *строка*, пароль аккаунта для этого Email-адреса.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "id": /* уникальный ID пользователя (целое число) */,
    "access_token": /* access_token (строка) */,
    "refresh_token": /* refresh_token (строка) */,
    "expires_in": /* timestamp времени окончания действия access_token (целое число) */
  }
  ```

- `users.setAvatar` – метод для установки аватара:

  Параметры:

  - `access_token` – *строка*, `access_token`;
  - `avatar` – *строка*, ссылка на изображение.

  В случае успешного выполнения, в `response` вернётся `true`.

  **Примечание**: в `avatar` допускается передача только ссылок, ведущих на 
  изображения из папки `/uploads` данного домена и загруженных только от имени 
  пользователя, для чьей страницы устанавливается аватар.

- `users.getUser` – метод для получения основной информации о пользователе:

  Параметры:

  - `id` – *целое число*, уникальный ID пользователя.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "id": /* уникальный ID пользователя (целое число) */,
    "status": /* не задокументировано в текущей версии документации */,
    "firstname": /* имя пользователя (строка) */,
    "lastname": /* фамилия пользователя (строка) */,
    "email": /* Email-адрес пользователя (строка) */,
    "avatar": /* Ссылка на аватар пользователя (строка) */
  }
  ```

- `users.getNewTokenPair` – метод для получения новой пары токенов 
  `access_token` / `refresh_token`:

  Параметры:

  - `refresh_token` – *строка*, `refresh_token`.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "id": /* уникальный ID пользователя (целое число) */,
    "new_access_token": /* новый access_token (строка) */,
    "new_refresh_token": /* новый refresh_token (строка) */,
    "expires_in": /* timestamp времени окончания действия new_access_token (целое число) */
  }
  ```

### `Posts`

Неймспейс `Posts` предоставляет доступ к постам пользователей.

Доступные методы:

- `posts.post` – метод постинга:

  Параметры:

  - `access_token` – *строка*, `access_token`;
  - `content` – *строка*, текст поста, от 1 до 128 символов;
  - `attachments` – *не поддерживается*.

  В случае успешного выполнения, в `response` вернётся `true`.

- `posts.getLastUserPosts` – метод для получения последних постов пользователя:

  Параметры:
  
  - `id` – *целое число*, уникальный ID пользователя;
  - `offset` – *целое число*, требуемое количество постов, не более 10;
  - `start` – *необязательный параметр*, *по умолчанию установлен в 0*, *целое 
    число*, стартовая позиция получения постов.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "left": /* оставшееся количество постов, кроме возвращённых (целое число) */,
    "posts": [
      {
        "post_id": /* уникальный ID текущего поста (целое число) */,
        "author": /* уникальный ID автора текущего поста (целое число) */,
        "content": /* текст текущего поста (строка) */,
        "attachments": /* вложения текущего поста (не поддерживается) */,
        "time": /* timestamp времени публикации текущего поста (целое число) */
      },
      /* ... */
    ]
  }
  ```

- `posts.getPostById` – метод для получения поста по его уникальному ID:

  Параметры:

  - `post_id` – *целое число*, уникальный ID поста.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "post_id": /* уникальный ID текущего поста (целое число) */,
    "author": /* уникальный ID автора текущего поста (целое число) */,
    "content": /* текст текущего поста (строка) */,
    "attachments": /* вложения текущего поста (не поддерживается) */,
    "time": /* timestamp времени публикации текущего поста (целое число) */
  }
  ```

- `posts.deletePost` – метод для удаления поста по его уникальному ID:

  Параметры:

  - `access_token` – *строка*, `access_token`;
  - `post_id` – *целое число*, уникальный ID поста.

  В случае успешного выполнения, в `response` вернётся `true`.

- `posts.getUserPostsCount` – метод для получения количества постов 
  пользователя:

  Параметры:

  - `id` – *целое число*, уникальный ID пользователя.

  В случае успешного выполнения, в `response` вернётся количество постов 
  пользователя (*целое число*).

### `Followers`

Неймспейс `Followers` предоставляет доступ к подпискам пользователей:

- `followers.isFollowed` – метод для получения статуса подписки пользователей:

  Параметры:

  - `follower` – *целое число*, уникальный ID пользователя, отправляющего 
    исходящую заявку;
  - `following` – *целое число*, уникальный ID пользователя, принимающего 
    входящую заявку.

  В случае успешного выполнения, в `response` возвращается один из возможных 
  статусов:

  - `0` – `follower` не подписан на `following` и `following` не подписан 
    на `follower`;
  - `1` – `follower` подписан на `following`;
  - `2` – `follower` дружит с `following`;
  - `3` – `following` подписан на `follower`.

- `followers.follow` – метод для подписки / добавления в друзья:

  Параметры:

  - `access_token` – *строка*, `access_token`;
  - `following` – *целое число*, уникальный ID пользователя, принимающего 
    входящую заявку.

  В случае успешного выполнения, в `response` вернётся `true`.

- `followers.unfollow` – метод для отписки / удаления из друзей:

  Параметры:

  - `access_token` – *строка*, `access_token`;
  - `following` – *целое число*, уникальный ID пользователя, принимающего 
    входящую заявку.

  В случае успешного выполнения, в `response` возвращается один из возможных 
  статусов:

- `followers.getUserFollowers` – метод для получения подписчиков пользователя:

  Параметры:

  - `id` – *целое число*, уникальный ID пользователя;
  - `offset` – *целое число*, требуемое количество подписчиков, не более 10;
  - `start` – *необязательный параметр*, *по умолчанию установлен в 0*, *целое 
    число*, стартовая позиция получения подписчиков.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "left": /* оставшееся количество подписчиков, кроме возвращённых (целое число) */,
    "followers": [
      {
        "id": /* уникальный ID текущего подписчика (целое число) */,
        "firstname": /* имя текущего подписчика (строка) */,
        "lastname": /* фамилия текущего подписчика (строка) */,
        "email": /* Email-адрес текущего пользователя (строка) */
      },
      /* ... */
    ]
  }
  ```

- `followers.getUserFriends` – метод для получения друзей пользователя:

  Параметры:

  - `id` – *целое число*, уникальный ID пользователя;
  - `offset` – *целое число*, требуемое количество друзей, не более 10;
  - `start` – *необязательный параметр*, *по умолчанию установлен в 0*, *целое 
    число*, стартовая позиция получения друзей.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "left": /* оставшееся количество подписчиков, кроме возвращённых (целое число) */,
    "friends": [
      {
        "id": /* уникальный ID текущего друга (целое число) */,
        "firstname": /* имя текущего друга (строка) */,
        "lastname": /* фамилия текущего друга (строка) */,
        "email": /* Email-адрес текущего пользователя (строка) */
      },
      /* ... */
    ]
  }
  ```

- `followers.getUserFollowing` – метод для получения подписок пользователя:

  Параметры:

  - `id` – *целое число*, уникальный ID пользователя;
  - `offset` – *целое число*, требуемое количество подписок, не более 10;
  - `start` – *необязательный параметр*, *по умолчанию установлен в 0*, *целое 
    число*, стартовая позиция получения подписок.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "left": /* оставшееся количество подписчиков, кроме возвращённых (целое число) */,
    "following": [
      {
        "id": /* уникальный ID текущего друга (целое число) */,
        "firstname": /* имя текущего друга (строка) */,
        "lastname": /* фамилия текущего друга (строка) */,
        "email": /* Email-адрес текущего пользователя (строка) */
      },
      /* ... */
    ]
  }
  ```


### `Images`

Неймспейс `Images` предоставляет доступ к пользовательским изображениям:

- `image.upload` – метод для загрузки пользовательского изображения:

  Параметры:

  - `access_token` – *строка*, `access_token`;
  - `following` – *файл*, *не более 1 МБ*, пользовательское изображение.

  В случае успешного выполнения, в `response` вернётся следующая структура:

  ```json
  {
    "path": /* абсолютный путь загруженного пользовательского изображения (строка) */
  }
  ```

  **Примечание №1**: пользовательские изображения загружаются в папку 
  `/uploads` и получают следующее название: `IDПОЛЬЗОВАТЕЛЯ_РАНДОМНЫЙMD5ХЕШ`, 
  например, `1_ff5183b8d3fb194222a88afc6d648bd2.jpg`.

  **Примечание №2**: все пользовательские изображения преобразуются в JPEG с 
  разрешением `300x300` пикселей.

## Общие коды ошибок

Список общих кодов ошибок (`error_code`):

- `0` – не все параметры переданы;
- `1` – неизвестная внутренняя ошибка;
- `2` – пользователь с таким Email-адресом уже зарегистрирован;
- `3` – пользователь с таким Email-адресом не зарегистрирован;
- `4` – пользователь с таким уникальным ID не зарегистрирован;
- `5` – неправильное имя пользователя или пароль;
- `6` – ошибочное представление access_token;
- `7` – истёкший `access_token`;
- `8` – ошибочный `refresh_token`;
- `9` – истёкший `refresh_token`;
- `10` – использованный `refresh_token`;
- `11` – пост с таким уникальным ID не существует;
- `12` – чужой пост;
- `13` – пользователи уже друзья;
- `14` – пользователь уже подписан;
- `15` – идентичные параметры, когда это недопустимо;
- `16` – пользователь не подписан;
- `17` – нет подписчиков;
- `18` – нет друзей;
- `19` – нет подписок;
- `20` – файл слишком большой;
- `21` – ссылка на ресурс, находящийся на другом домене.